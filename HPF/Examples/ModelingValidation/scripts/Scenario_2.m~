% MATLAB test scripts
% Using MATLAB with Modelica environments is difficult as there are numerous 
% tools. An easier and more efficient way is to simulate Modelica model and
% use the output mat file to run the post processing analysis.
%
% For now sticking with OpenModelica and Dymola.
%
% Testing sensors and rectifier
%

%% script initializations
addpath('./lib')

% model name
modelName = 'Scenario_1';
%% file path for OpenModelica mat file
matFile_path = '/home/avpreetsingh/OpenModelica_workspace/HPF.Examples.ModelingValidation.Scenario_2/HPF.Examples.ModelingValidation.Scenario_2_res.mat';
%% file path for Dymola mat file
% matFile_path = ''

res = modelicaImport(matFile_path);
% correction ---------------
% There is a bug in the 'modelicaImport.m' function. It fails to populate the varaible
% voltageSource.vSrc_phC.v
% Therefore, manually doing that.. functions with prefix 'tmp_' are all 
% temporary fix.
tmpVar = tmp_getModelicaVar_cmplxVect(matFile_path, 'voltageSource.vSrc_phC.v');
res.voltageSource.vSrc_phC.v = tmpVar;


h = res.systemDef.numHrm;
% getting data from all the devices

% input voltage
inputVoltage = voltageSrc_3ph(h, res.voltageSource);

% converters
LaptopCharger_1 = AC2DC_converter_1ph(h, res.Laptop_charger_3);
LedDriver_1 = AC2DC_converter_1ph(h, res.LED_Driver_2);
PowerSupply_1 = AC2DC_converter_1ph(h, res.Power_Supply_1);

% DC loads


% d